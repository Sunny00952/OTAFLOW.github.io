<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <style type="text/css">
    a:link { color: black; text-decoration: none; }
    a:visited { color: black; text-decoration: none; }
    a:hover { color: blue; text-decoration: underline; }

    .table { width: 100%; table-layout: fixed; border-collapse: collapse; margin: 0 auto; }
    .table td { width: 33.33% !important; padding: 10px; text-align: center; }
    .table audio { width: 100% !important; max-width: none; }

    /* 容器强化：最大宽度 1200px、居中、左右内边距 15px */
    #div2, #nonparallel_div { width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 15px; }

    /* 响应式表格：横向滚动、触摸平滑 */
    .table-responsive { display: table; width: 100%; margin-bottom: 1rem; overflow-x: auto; -webkit-overflow-scrolling: touch; }
  </style>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <meta name="description" content=""/>
  <meta name="author" content=""/>
  <title>OTAFlow Demo</title>

  <!-- 免费 FontAwesome 图标 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>
  <!-- 主主题样式（含 Bootstrap） -->
  <link href="css/styles.css" rel="stylesheet">
  <!-- 自定义字体 -->
  <link rel="stylesheet" href="css/heading.css">
  <link rel="stylesheet" href="css/body.css">
  <!-- Bootstrap 滑块样式 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/11.0.2/css/bootstrap-slider.min.css" integrity="sha512-3q8fi8M0VS+X/3n64Ndpp6Bit7oXSiyCnzmlx6IDBLGlY5euFySyJ46RUlqIVs0DPCGOypqP8IRk/EyPvU28mQ==" crossorigin="anonymous" />

  <script>
    /**
     * 通用音频表格生成函数
     * config 结构：
     *   dir        : 音频根目录
     *   sample     : { id, script, emotion? }
     *   models     : 二维数组，每行代表一行模型
     *   headerType : 'emotion' | 'script' | 'both'
     */
    function createAudioTable(config) {
      let html = '<table class="table table-responsive mb4" style="width:100%;margin:0 auto;background:white;border-radius:20px;">';

      /* Headers */
      html += '<thead><tr><th colspan="5">';
      if (config.headerType === 'both') {
        html += `<div class="text-left">Emotion:<i>${config.sample.emotion}</i></div>`;
        html += `<div class="text-left">Text:<i>${config.sample.script}</i></div>`;
      } else if (config.headerType === 'script') {
        html += `<div class="text-left">Text:<i>${config.sample.script}</i></div>`;
      }
      html += '</th></tr></thead><tbody>';

      config.models.forEach(rowModels => {
        html += '<tr>';
        rowModels.forEach(model => {
          html += '<td style="vertical-align:top;text-align:center;width:20%;">';
          html += `<p>${model.name}</p>`;
          html += `<audio controls style="width:100%">
                     <source src="${config.dir}/${model.folder}/${config.sample.id}.wav" type="audio/wav">
                   </audio>`;
          html += '</td>';
        });
        const remainder = 5 - rowModels.length;
        if (remainder > 0) {
          html += `<td colspan="${remainder}" style="width:${remainder*20}%"></td>`;
        }
        html += '</tr>';
      });

      html += '</tbody></table>';
      return html;
    }
  </script>
</head>

<body id="page-top">
  <!-- Nav -->
  <nav class="navbar navbar-expand-lg bg-secondary fixed-top" id="mainNav">
    <div class="container">
      <a class="navbar-brand js-scroll-trigger" href="#page-top">OTAFlow</a>
      <button class="navbar-toggler navbar-toggler-right font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="切换导航">
        菜单 <i class="fas fa-bars"></i>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#abstract">Abstract</a></li>
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#comparisons">Comparisons</a></li>
          <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#ablations">Ablations</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Topic -->
  <header class="masthead bg-white text-left">
    <div class="container d-flex align-items-center flex-column">
      <h1 class="masthead-heading mb-0">
        OTAFLOW: EXPRESSIVE SPEECH SYNTHESIS VIA OPTIMAL TRANSPORT GUIDED STYLE ALIGNMENT AND CONDITIONAL FLOW MATCHING
      </h1>
    </div>
  </header>

  <!-- Abstract -->
  <section class="page-section portfolio" id="abstract">
    <div class="container">
      <div class="text-center">
        <h2 class="page-section-heading text-secondary mb-0 d-inline-block">Abstract</h2>
      </div>
      <div class="divider-custom"><div class="divider-custom"></div></div>
      <div class="row justify-content-center">
        <div class="col-lg-12 ml-auto">
          <p class="legend lead">
            &nbsp; Expressive speech synthesis aims to synthesize speech with richer emotional fluctuations and stylistic variations to improve the speech's human-like quality. Although recent methods have achieved impressive progress, two challenges still exist: (1) the one-to-many problem from text prompts to speeches, and (2) the effective control of complex style factors. To this end, we propose an expressive TTS model OTAFlow based on Optimal Transport guided style Alignment and conditional Flow matching (CFM), which uses reference speech or natural speech as style prompts to control the style of synthesized speech. To address the problem of unifying style prompts and speech features, especially the one-to-many problem of prompts versus speech, we introduce optimal transport to measure the gap in modal distributions and align speech and prompts in the latent space of CLAP. We inject style features into the CFM based non-autoregressive TTS model via Adaptive Layer Normalization in the diffusion transformer. Experimental results show that our model achieves significant improvements in both speech quality and naturalness.
          </p>
          <br><br>
        </div>
        <div class="text-center">
          <br>
          <img width="100%" src=".\otetts1.png"/>
          <br>
          <em>OTAFlow  Overview</em>
          <br>
        </div>
      </div>
    </div>
  </section>

<script>
function createTableForMainComparison(audioName, dir, script) {
  const parallelExp = {
    "Reference": "gt",
    "OTAFlow": "SpotlightTTS"
  };

  let html = '<table class="table table-responsive mb3" style="background:white;border-radius:20px;width:100%;margin:0 auto;table-layout:fixed;">'; // 添加 table-layout:fixed
  html += '<thead><tr><th colspan="2" style="width:100%">'; // 改为 colspan="2"
  html += '<div class="text-left">Text:<i>' + script.script + '</i></div>';
  html += "</th></tr></thead><tbody>";

  html += "<tr>";
  ["Reference", "OTAFlow"].forEach(modelName => {
    html += '<td style="vertical-align:top;text-align:center;width:50%;min-width:250px;padding:20px;">'; // 添加宽度控制
    html += "<p style='margin-bottom:15px;font-size:18px;'>" + modelName + "</p>";
    html += `<audio controls style="width:100%;max-width:280px;margin:0 auto;display:block;"><source src="${dir}/${parallelExp[modelName]}/${audioName}.wav" type="audio/wav"></audio>`;
    html += '</td>';
  });
  html += '</tr>'; // 移除注释的 colspan="3"

  html += "</tbody></table>";
  return html;
}
</script>

  <!-- Comparisons -->
  <section class="page-section bg-info text-white mb0" id="comparisons">
    <div class="container">
      <div class="text-center">
        <h2 class="page-section-heading d-inline-block text-white">Comparisons</h2>
      </div>
      <div class="text-center"><br></div>
      <div class="divider-custom divider-light"><div class="divider-custom"></div></div>

      <div class="row">
        <div id="div2" class="col-12-auto mx-auto">
          <script>
            const dir = "./wavs/Parallel";
            const audios = [
              { id: "0015_000383", emotion: "愤怒", script: "This used to be jerrys occupation." },
              { id: "0012_000732", emotion: "开心", script: "Who is been repeating all that hard stuff to you?" },
              { id: "0018_001445", emotion: "惊讶", script: "The nastiest things they saw were the cobwebs." },
              { id: "0020_001076", emotion: "悲伤", script: "Let's make the noise a snake." }
            ];
            audios.forEach(function(sample) {
              const div = document.getElementById("div2");
              const html = createTableForMainComparison(sample.id, dir, sample);
              div.insertAdjacentHTML("beforeend", html);
            });
          </script>
        </div>
      </div>
    </div>
  </section>

  <!-- Ablations -->
  <section class="page-section bg-secondary mb-0" id="ablations">
    <div class="container">
      <div class="text-center">
        <h2 class="page-section-heading d-inline-block text-white">Ablations</h2>
      </div>
      <div class="text-center"><br></div>
      <div class="divider-custom divider-light"><div class="divider-custom"></div></div>

      <div class="row">
        <div id="nonparallel_div" class="col-lg-auto ml-auto">
          <script>
            const nonParallelSamples = [
              {
                id: "0013_000380",
                refText: "must a name mean something ?",
                Script: "I thought you mean how old are you?"
              },
              {
                id: "0018_000400",
                refText: "rabbit gave a dog a hurrying up sort of nudge .",
                Script: "Let's make the noise a snake."
              },
              {
                id: "0011_000045",
                refText: "the nastiest things they saw were the cobwebs .",
                Script: "In which fox loses a tail and its elder sister finds one."
              },
              {
                id: "0012_000744",
                refText: "",
                Script: "The football teams give a tea party."
              }
            ];

            const npModels = {
              "Reference": "GT",
              "A": "StyleSpeech",
              "B": "CSE",
              "C": "GenerSpeech",
              "FULL": "SpotlightTTS"
            };

            function createNonParallelTable(dir, sample) {
              let html = '<table class="table table-responsive" style="background:white;border-radius:20px">';
              html += '<thead><tr><th colspan="5" style="width:40%">';
              html += '<div class="text-left">Text:<i>' + sample.Script + '</i></div>';
              html += "</th></tr></thead><tbody>";

              html += "<tr>";
              ["Reference","OTAFlow"].forEach(model => {
                html += '<td style="vertical-align:top;text-align:center;">';
                html += "<p>" + model + "</p>";
                html += '<audio controls><source src="' + dir + '/' + npModels[model] + '/' + sample.id + '.wav" type="audio/wav"></audio>';
                html += '</td>';
              });
              html += '<td colspan="3"></td></tr>';


              html += "<tr>";
              ["A", "B", "C"].forEach(model => {
                html += '<td style="vertical-align:top;text-align:center;">';
                html += "<p>" + model + "</p>";
                html += '<audio controls><source src="' + dir + '/' + npModels[model] + '/' + sample.id + '.wav" type="audio/wav"></audio>';
                html += '</td>';
              });
              html += '<td colspan="2"></td></tr>';

              html += "</tbody></table>";
              return html;
            }

            const nonParallelDir = "./wavs/NonParallel";
            nonParallelSamples.forEach(sample => {
              const divElem = document.getElementById("nonparallel_div");
              const tableHtml = createNonParallelTable(nonParallelDir, sample);
              divElem.insertAdjacentHTML("beforeend", tableHtml);
            });
          </script>
        </div>
      </div>
    </div>
  </section>


</body>

</html>
